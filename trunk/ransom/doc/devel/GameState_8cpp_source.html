<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>RANSOM: src/GameState.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">RANSOM
   &#160;<span id="projectnumber">1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('GameState_8cpp_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">GameState.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="GameState_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="GameState_8hpp.html">GameState.hpp</a>&quot;</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &lt;cassert&gt;</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keyword">using namespace </span>OgreBulletCollisions;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="keyword">using namespace </span>OgreBulletDynamics;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="keyword">using namespace </span>Ogre;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div>
<div class="line"><a name="l00010"></a><span class="lineno"><a class="code" href="classGameState.html#a4fa0a2bf50315c4a35a3890a0adcee5c">   10</a></span>&#160;<a class="code" href="classGameState.html#a4fa0a2bf50315c4a35a3890a0adcee5c" title="default constructor ">GameState::GameState</a>()</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;  {</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;    clear();</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;  }</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div>
<div class="line"><a name="l00015"></a><span class="lineno"><a class="code" href="classGameState.html#aa19f7b265ddcdf1c490b1c43556d07e1">   15</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classGameState.html#aa19f7b265ddcdf1c490b1c43556d07e1" title="method to clear the state ">GameState::clear</a>() {</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;    m_bLMouseDown       = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;    m_bRMouseDown       = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;    m_bQuit             = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    m_pSceneMgr         = NULL;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;    m_hero              = NULL;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    m_pOverlayMgr       = NULL;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    m_enemies.clear();</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    m_hostages.clear();</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    _vCharacters.clear();</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    _world              = NULL;</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    _camerasController  = NULL;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    _vFader.clear();</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    _tiempo             = 0;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    _hostages           = 1;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;        _rtex = NULL;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;        _textureListener = NULL;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;        _cameraMiniMap = NULL;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;        _staticGeometry = NULL;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;        _lastPanelLife = 0;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;        _tiempoMostrarFinal = 0;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;        _faderFinish = NULL;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  }</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div>
<div class="line"><a name="l00039"></a><span class="lineno"><a class="code" href="classGameState.html#ad5fb5f0049130bf300410c9f31220f7f">   39</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classGameState.html#ad5fb5f0049130bf300410c9f31220f7f" title="this method was performed at enter of this app state ">GameState::enter</a>()</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  {</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;        clear();</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    OgreFramework::getSingletonPtr()-&gt;getLogMgrPtr()-&gt;logMessage(<span class="stringliteral">&quot;Entering GameState...&quot;</span>);</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    m_pOverlayMgr = Ogre::OverlayManager::getSingletonPtr();</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="comment">// Overlays con fundidos de negro al color del overlay</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <a class="code" href="classFader.html" title="Class to manage the Fader effect on the overlays. ">Fader</a>* fader = NULL;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    fader = <span class="keyword">new</span> <a class="code" href="classFader.html" title="Class to manage the Fader effect on the overlays. ">Fader</a> ( <span class="stringliteral">&quot;GUI_Game&quot;</span>, <span class="stringliteral">&quot;Game/Recuadro&quot;</span>, NULL );</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    _vFader.push_back ( fader );</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    fader = <span class="keyword">new</span> <a class="code" href="classFader.html" title="Class to manage the Fader effect on the overlays. ">Fader</a> ( <span class="stringliteral">&quot;GUI_Game&quot;</span>, <span class="stringliteral">&quot;Game/Face&quot;</span>, NULL );</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    _vFader.push_back ( fader );</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    fader = <span class="keyword">new</span> <a class="code" href="classFader.html" title="Class to manage the Fader effect on the overlays. ">Fader</a> ( <span class="stringliteral">&quot;GUI_Game&quot;</span>, <span class="stringliteral">&quot;Game/Life4&quot;</span>, NULL );</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    _vFader.push_back ( fader );</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    fader = <span class="keyword">new</span> <a class="code" href="classFader.html" title="Class to manage the Fader effect on the overlays. ">Fader</a> ( <span class="stringliteral">&quot;GUI_Game&quot;</span>, <span class="stringliteral">&quot;Game/Time&quot;</span>, NULL );</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    _vFader.push_back ( fader );</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    fader = <span class="keyword">new</span> <a class="code" href="classFader.html" title="Class to manage the Fader effect on the overlays. ">Fader</a> ( <span class="stringliteral">&quot;GUI_Game&quot;</span>, <span class="stringliteral">&quot;Game/Hostages&quot;</span>, NULL );</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    _vFader.push_back ( fader );</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    fader = <span class="keyword">new</span> <a class="code" href="classFader.html" title="Class to manage the Fader effect on the overlays. ">Fader</a> ( <span class="stringliteral">&quot;GUI_Game&quot;</span>, <span class="stringliteral">&quot;Game/Recuadro_MiniMapa&quot;</span>, NULL );</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    _vFader.push_back ( fader );</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        <span class="comment">// Carga de sonidos</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    _soundGameOver = <a class="code" href="classSoundFXManager.html#a389a07b5b177b82dd6d1b20e294acb2f">SoundFXManager::getSingleton</a>().<a class="code" href="classSoundFXManager.html#a0c6833e2c3e1643a0539a9855b843d8f">load</a>(<span class="stringliteral">&quot;gameover.wav&quot;</span>);</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    _soundFinish = <a class="code" href="classSoundFXManager.html#a389a07b5b177b82dd6d1b20e294acb2f">SoundFXManager::getSingleton</a>().<a class="code" href="classSoundFXManager.html#a0c6833e2c3e1643a0539a9855b843d8f">load</a>(<span class="stringliteral">&quot;finish.wav&quot;</span>);</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    _gameTrack = <a class="code" href="classTrackManager.html#a8c49496512dbaaee9a1190897156d590">TrackManager::getSingleton</a>().<a class="code" href="classTrackManager.html#a3bd7c6475c47d19d8bea0e65c359bc85">load</a>(<span class="stringliteral">&quot;ingame.mp3&quot;</span>);</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="comment">// // Reproducci√≥n del track principal...</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    _gameTrack-&gt;play();</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    m_pSceneMgr = OgreFramework::getSingletonPtr()-&gt;getRootPtr()-&gt;createSceneManager(ST_GENERIC, <span class="stringliteral">&quot;GameSceneMgr&quot;</span>);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    CreateCameras();</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="comment">// Creacion del mundo (definicion de los limites y la gravedad) ---</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    AxisAlignedBox worldBounds = AxisAlignedBox (</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    Vector3 (-10000, -10000, -10000),</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    Vector3 (10000,  10000,  10000));</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    Vector3 gravity = Vector3(0, -9.8, 0);</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    _world = <span class="keyword">new</span> OgreBulletDynamics::DynamicsWorld ( m_pSceneMgr,</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;           worldBounds, gravity);</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    OgreFramework::getSingletonPtr()-&gt;getSDKTrayMgrPtr()-&gt;hideCursor();</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="comment">// Mostramos el loading a pantalla completa</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    Ogre::OverlayElement *elem;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    elem = m_pOverlayMgr-&gt;getOverlayElement(<span class="stringliteral">&quot;Panel_Loading_Game&quot;</span>);</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    elem-&gt;setDimensions(OgreFramework::getSingletonPtr()-&gt;_factorX, OgreFramework::getSingletonPtr()-&gt;_factorY);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    elem = m_pOverlayMgr-&gt;getOverlayElement(<span class="stringliteral">&quot;Panel_Game_Over&quot;</span>);</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    elem-&gt;setDimensions(OgreFramework::getSingletonPtr()-&gt;_factorX, OgreFramework::getSingletonPtr()-&gt;_factorY);</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    elem = m_pOverlayMgr-&gt;getOverlayElement(<span class="stringliteral">&quot;Panel_Finish&quot;</span>);</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    elem-&gt;setDimensions(OgreFramework::getSingletonPtr()-&gt;_factorX, OgreFramework::getSingletonPtr()-&gt;_factorY);</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <a class="code" href="classUtilities.html#aac351cff9a13eb2d6bd02f38c5b062c0" title="method to get the Utilities object ">Utilities::getSingleton</a>().<a class="code" href="classUtilities.html#a153165e07ae59015a8abdecb84b8d521" title="method to put an overlay in the scene This method put an overlay created in ransom.overlay file, also the name should be defined in this file with the set of specifications ">put_overlay</a> ( m_pOverlayMgr, <span class="stringliteral">&quot;GUI_GameOver&quot;</span>, <span class="keyword">false</span> );</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <a class="code" href="classUtilities.html#aac351cff9a13eb2d6bd02f38c5b062c0" title="method to get the Utilities object ">Utilities::getSingleton</a>().<a class="code" href="classUtilities.html#a153165e07ae59015a8abdecb84b8d521" title="method to put an overlay in the scene This method put an overlay created in ransom.overlay file, also the name should be defined in this file with the set of specifications ">put_overlay</a> ( m_pOverlayMgr, <span class="stringliteral">&quot;GUI_Finish&quot;</span>, <span class="keyword">false</span> );</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <a class="code" href="classUtilities.html#aac351cff9a13eb2d6bd02f38c5b062c0" title="method to get the Utilities object ">Utilities::getSingleton</a>().<a class="code" href="classUtilities.html#a153165e07ae59015a8abdecb84b8d521" title="method to put an overlay in the scene This method put an overlay created in ransom.overlay file, also the name should be defined in this file with the set of specifications ">put_overlay</a> ( m_pOverlayMgr, <span class="stringliteral">&quot;Loading_Game&quot;</span>, <span class="keyword">true</span> );</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    OgreFramework::getSingletonPtr()-&gt;getRootPtr()-&gt;renderOneFrame();</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        <span class="comment">// Cargamos el fichero de configuracion</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <a class="code" href="classXMLCharger.html#a4688c3a087087ee22a553921b8b76f53" title="Method to get the object of the class (singleton pattern) ">XMLCharger::getSingleton</a>().<a class="code" href="classXMLCharger.html#ab3db94490a43ee8587a21deef467671e" title="method to load the xml config from disk ">LoadGameConfig</a> ( <a class="code" href="GameState_8hpp.html#a246b26afd5b6d06ad9fe626dbb78bad9">FILE_ROUTE_XML</a>, _gc );</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="preprocessor">#ifdef _DEBUG</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="preprocessor"></span>    _gc.print();</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="comment">// Creacion de los elementos iniciales del mundo</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    CreateInitialWorld();</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <a class="code" href="classUtilities.html#aac351cff9a13eb2d6bd02f38c5b062c0" title="method to get the Utilities object ">Utilities::getSingleton</a>().<a class="code" href="classUtilities.html#a153165e07ae59015a8abdecb84b8d521" title="method to put an overlay in the scene This method put an overlay created in ransom.overlay file, also the name should be defined in this file with the set of specifications ">put_overlay</a> ( m_pOverlayMgr, <span class="stringliteral">&quot;Loading_Game&quot;</span>, <span class="keyword">false</span> );</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; _vFader.size(); i++ )</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;      <span class="keywordflow">if</span> (_vFader[i]) _vFader[i]-&gt;startFadeOut(4.0);</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;}</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div>
<div class="line"><a name="l00125"></a><span class="lineno"><a class="code" href="classGameState.html#a8b6337e017e4f8989953e214e5a0d0cd">  125</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classGameState.html#a8b6337e017e4f8989953e214e5a0d0cd" title="method to create scene world ">GameState::CreateInitialWorld</a>()</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  {</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="comment">// Activamos las sombras</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    m_pSceneMgr-&gt;setShadowTechnique(Ogre::SHADOWTYPE_STENCIL_ADDITIVE);</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        m_pSceneMgr-&gt;setShadowTextureSelfShadow(<span class="keyword">true</span>);</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    m_pSceneMgr-&gt;setShadowColour(Ogre::ColourValue(0.5, 0.5, 0.5) );</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        m_pSceneMgr-&gt;setShadowTexturePixelFormat(Ogre::PF_FLOAT16_RGB);</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    m_pSceneMgr-&gt;setShadowTextureCount(2);</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    m_pSceneMgr-&gt;setShadowTextureSize(512);</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        <span class="comment">// Generamos la configuracion de del Mapa aleatorio</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        _gc.createMapRandom();</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="comment">// Crear el mapa</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    CreateMap();</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="comment">// Creamos al Heroe</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    Ogre::Vector3 v_pos;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    v_pos = _gc.getInitialPosHero();</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    m_hero = <span class="keyword">new</span> <a class="code" href="classHero.html">Hero</a> ( m_pSceneMgr, _world, <span class="stringliteral">&quot;Hero&quot;</span>, v_pos );</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    _vCharacters.push_back(m_hero);</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="comment">// Creamos los enemigos</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <a class="code" href="classEnemy.html">Enemy</a> *enemy = NULL;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="keywordtype">string</span> name_enemy = <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <a class="code" href="classEnemyRoute.html" title="Class to manage the enemy route. ">EnemyRoute</a> route;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    Ogre::Vector3 v;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; _gc.getNumEnemies(); i++ )</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;      {</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        route = _gc.getEnemyRoute ( i );</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        assert ( route.<a class="code" href="classEnemyRoute.html#ad5c67b807f8a186f1ddc01ae7db8ac65" title="Method to get number of points in the route. ">getNumPoints</a>() != 0 );</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        v = route.<a class="code" href="classEnemyRoute.html#a394d41e17e06de40f7501a58b32bad27" title="Method to get the point acoording the index value in the points vector. ">getPoint</a> ( 0 );</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        name_enemy = <span class="stringliteral">&quot;Enemy&quot;</span> + StringConverter::toString(i);</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        enemy = <span class="keyword">new</span> <a class="code" href="classEnemy.html">Enemy</a> ( m_pSceneMgr, _world, name_enemy, v, route, m_hero );</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        m_enemies.push_back ( enemy );</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        _vCharacters.push_back(enemy);</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;      }</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    _hostages = _gc.getNumHostages();</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; _gc.getNumHostages(); i++ )</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;      {</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        <span class="keywordtype">string</span> name_hostage = <span class="stringliteral">&quot;Hostage&quot;</span> + StringConverter::toString(i);</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        <a class="code" href="classHostage.html">Hostage</a>* hostage = <span class="keyword">new</span> <a class="code" href="classHostage.html">Hostage</a> ( m_pSceneMgr, _world, name_hostage, _gc.getPositionHostage(i) );</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        m_hostages.push_back ( hostage );</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        _vCharacters.push_back ( hostage );</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;      }</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        <span class="comment">// Creamos el controlador de las camaras para que sigan al heroe</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        _camerasController = <span class="keyword">new</span> <a class="code" href="classCamerasController.html">CamerasController</a>(m_pSceneMgr, m_pCamera, _cameraMiniMap, m_hero);</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="comment">// Creamos el MiniMapa</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="comment">//*************************************************************************</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    CreateMiniMap();</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        <span class="comment">// Creamos las luz del escenario</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    Light* luz = m_pSceneMgr-&gt;createLight(<span class="stringliteral">&quot;Luz&quot;</span>);</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    luz-&gt;setType(Light::LT_POINT);</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    luz-&gt;setPosition(50,100,50);</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    luz-&gt;setSpecularColour(1, 1, 1);</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    luz-&gt;setDiffuseColour(1, 1, 1);</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;}</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div>
<div class="line"><a name="l00193"></a><span class="lineno"><a class="code" href="classGameState.html#a2aa851b81bf9ebbc9aa7d9ecf1b8976e">  193</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classGameState.html#a2aa851b81bf9ebbc9aa7d9ecf1b8976e" title="method to create game camera and minimap camera ">GameState::CreateCameras</a>() {</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        m_pCamera = m_pSceneMgr-&gt;createCamera ( <span class="stringliteral">&quot;GameCamera&quot;</span> );</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    m_pCamera-&gt;setNearClipDistance(1);</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    OgreFramework::getSingletonPtr()-&gt;getViewportPtr()-&gt;setCamera ( m_pCamera );</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        m_pCamera-&gt;setAspectRatio(Ogre::Real(OgreFramework::getSingletonPtr()-&gt;getViewportPtr()-&gt;getActualWidth()) /</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;                            Ogre::Real(OgreFramework::getSingletonPtr()-&gt;getViewportPtr()-&gt;getActualHeight()));</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        <span class="comment">// Creamos la camara del mini mapa</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        _cameraMiniMap = m_pSceneMgr-&gt;createCamera ( <span class="stringliteral">&quot;CameraMiniMap&quot;</span> );</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;}</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div>
<div class="line"><a name="l00204"></a><span class="lineno"><a class="code" href="classGameState.html#a32f6c4b9c9a0492d740e90461b3ecdb9">  204</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classGameState.html#a32f6c4b9c9a0492d740e90461b3ecdb9" title="method to create mini map of game ">GameState::CreateMiniMap</a>() {</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="comment">// Creamos la textura donde vamos a meter el mapa que va visualizarse a partir de la camara</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    Ogre::TexturePtr _rtt = Ogre::TextureManager::getSingleton().createManual (</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;            <a class="code" href="GameState_8hpp.html#a523b7471b1f9793c3208141cefa02c78">NAME_TEXTUTE_MINIMAP</a>, Ogre::ResourceGroupManager::DEFAULT_RESOURCE_GROUP_NAME,</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;            Ogre::TEX_TYPE_2D, 256, 256, 0, Ogre::PF_A8R8G8B8, Ogre::TU_RENDERTARGET );</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    _rtex = _rtt-&gt;getBuffer()-&gt;getRenderTarget();</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;          <span class="comment">// Vinculamos la camara con la textura</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    _rtex-&gt;addViewport ( _cameraMiniMap );</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    _rtex-&gt;getViewport(0)-&gt;setClearEveryFrame ( <span class="keyword">true</span> );</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    _rtex-&gt;getViewport(0)-&gt;setBackgroundColour ( Ogre::ColourValue::Black );</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    _rtex-&gt;getViewport(0)-&gt;setOverlaysEnabled ( <span class="keyword">false</span> );</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    _rtex-&gt;setAutoUpdated(<span class="keyword">true</span>);</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="comment">// Creamos el material al que le vamos a asginar la textura</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    MaterialPtr mPtr = MaterialManager::getSingleton().create ( <a class="code" href="GameState_8hpp.html#ae57cebd1bd814ed81094366fa5fd702b">NAME_MATERIAL_MINIMAP</a>, Ogre::ResourceGroupManager::DEFAULT_RESOURCE_GROUP_NAME );</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    Technique* matTechnique = mPtr-&gt;createTechnique();</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    matTechnique-&gt;createPass();</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    mPtr-&gt;getTechnique(0)-&gt;getPass(0)-&gt;setLightingEnabled(<span class="keyword">true</span>);</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    mPtr-&gt;getTechnique(0)-&gt;getPass(0)-&gt;setDiffuse(0.9,0.9,0.9,1);</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    mPtr-&gt;getTechnique(0)-&gt;getPass(0)-&gt;setSelfIllumination(0.4,0.4,0.4);</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="comment">// Le asignamos la textura que hemos creado</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    mPtr-&gt;getTechnique(0)-&gt;getPass(0)-&gt;createTextureUnitState(<a class="code" href="GameState_8hpp.html#a523b7471b1f9793c3208141cefa02c78">NAME_TEXTUTE_MINIMAP</a>);</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;          <span class="comment">// Le vinculamos el listener a la textura</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        _textureListener = <span class="keyword">new</span> <a class="code" href="classMiniMapTextureListener.html" title="class to be used how listener in the texture for the mini map This class performs a change between re...">MiniMapTextureListener</a> (m_pSceneMgr ,_vCharacters );</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    _rtex-&gt;addListener ( _textureListener );</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;     Ogre::OverlayElement *elem;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;         <span class="comment">// Asignamos el material al Overlay en el que mostramos el mapa</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;     elem = m_pOverlayMgr-&gt;getOverlayElement(<span class="stringliteral">&quot;Panel_Mini_Map_Game&quot;</span>);</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;     elem-&gt;setMaterialName ( <a class="code" href="GameState_8hpp.html#ae57cebd1bd814ed81094366fa5fd702b">NAME_MATERIAL_MINIMAP</a>);</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  }</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div>
<div class="line"><a name="l00240"></a><span class="lineno"><a class="code" href="classGameState.html#a5069c4bdb6a54cd8f365ced87883f714">  240</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classGameState.html#a5069c4bdb6a54cd8f365ced87883f714" title="this method was performed at pause the game ">GameState::pause</a>()</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  {</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    OgreFramework::getSingletonPtr()-&gt;getLogMgrPtr()-&gt;logMessage(<span class="stringliteral">&quot;Pausing GameState...&quot;</span>);</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <a class="code" href="classUtilities.html#aac351cff9a13eb2d6bd02f38c5b062c0" title="method to get the Utilities object ">Utilities::getSingleton</a>().<a class="code" href="classUtilities.html#a153165e07ae59015a8abdecb84b8d521" title="method to put an overlay in the scene This method put an overlay created in ransom.overlay file, also the name should be defined in this file with the set of specifications ">put_overlay</a> ( m_pOverlayMgr, <span class="stringliteral">&quot;GUI_Game&quot;</span>, <span class="keyword">false</span> );</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <a class="code" href="classUtilities.html#aac351cff9a13eb2d6bd02f38c5b062c0" title="method to get the Utilities object ">Utilities::getSingleton</a>().<a class="code" href="classUtilities.html#a153165e07ae59015a8abdecb84b8d521" title="method to put an overlay in the scene This method put an overlay created in ransom.overlay file, also the name should be defined in this file with the set of specifications ">put_overlay</a> ( m_pOverlayMgr, <span class="stringliteral">&quot;GUI_GameOver&quot;</span>, <span class="keyword">false</span> );</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <a class="code" href="classUtilities.html#aac351cff9a13eb2d6bd02f38c5b062c0" title="method to get the Utilities object ">Utilities::getSingleton</a>().<a class="code" href="classUtilities.html#a153165e07ae59015a8abdecb84b8d521" title="method to put an overlay in the scene This method put an overlay created in ransom.overlay file, also the name should be defined in this file with the set of specifications ">put_overlay</a> ( m_pOverlayMgr, <span class="stringliteral">&quot;GUI_Finish&quot;</span>, <span class="keyword">false</span> );</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  }</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;</div>
<div class="line"><a name="l00253"></a><span class="lineno"><a class="code" href="classGameState.html#a8fd781fb40cb9de76b98cfc98f7b2f13">  253</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classGameState.html#a8fd781fb40cb9de76b98cfc98f7b2f13" title="this method was performed at resume from pause game ">GameState::resume</a>()</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  {</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    OgreFramework::getSingletonPtr()-&gt;getLogMgrPtr()-&gt;logMessage(<span class="stringliteral">&quot;Resuming GameState...&quot;</span>);</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    OgreFramework::getSingletonPtr()-&gt;getViewportPtr()-&gt;setCamera(m_pCamera);</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <a class="code" href="classUtilities.html#aac351cff9a13eb2d6bd02f38c5b062c0" title="method to get the Utilities object ">Utilities::getSingleton</a>().<a class="code" href="classUtilities.html#a153165e07ae59015a8abdecb84b8d521" title="method to put an overlay in the scene This method put an overlay created in ransom.overlay file, also the name should be defined in this file with the set of specifications ">put_overlay</a> ( m_pOverlayMgr, <span class="stringliteral">&quot;GUI_Game&quot;</span>, <span class="keyword">true</span> );</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    OgreFramework::getSingletonPtr()-&gt;getSDKTrayMgrPtr()-&gt;hideCursor();</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    _gameTrack-&gt;play();</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  }</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div>
<div class="line"><a name="l00267"></a><span class="lineno"><a class="code" href="classGameState.html#acf49a6ea192c0a63100665332d884b4c">  267</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classGameState.html#acf49a6ea192c0a63100665332d884b4c" title="this method was performed at exit of this app state ">GameState::exit</a>()</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  {</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    OgreFramework::getSingletonPtr()-&gt;getLogMgrPtr()-&gt;logMessage(<span class="stringliteral">&quot;Leaving GameState...&quot;</span>);</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        <a class="code" href="classUtilities.html#aac351cff9a13eb2d6bd02f38c5b062c0" title="method to get the Utilities object ">Utilities::getSingleton</a>().<a class="code" href="classUtilities.html#a153165e07ae59015a8abdecb84b8d521" title="method to put an overlay in the scene This method put an overlay created in ransom.overlay file, also the name should be defined in this file with the set of specifications ">put_overlay</a> ( m_pOverlayMgr, <span class="stringliteral">&quot;GUI_Game&quot;</span>, <span class="keyword">false</span> );</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <a class="code" href="classUtilities.html#aac351cff9a13eb2d6bd02f38c5b062c0" title="method to get the Utilities object ">Utilities::getSingleton</a>().<a class="code" href="classUtilities.html#a153165e07ae59015a8abdecb84b8d521" title="method to put an overlay in the scene This method put an overlay created in ransom.overlay file, also the name should be defined in this file with the set of specifications ">put_overlay</a> ( m_pOverlayMgr, <span class="stringliteral">&quot;GUI_GameOver&quot;</span>, <span class="keyword">false</span> );</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <a class="code" href="classUtilities.html#aac351cff9a13eb2d6bd02f38c5b062c0" title="method to get the Utilities object ">Utilities::getSingleton</a>().<a class="code" href="classUtilities.html#a153165e07ae59015a8abdecb84b8d521" title="method to put an overlay in the scene This method put an overlay created in ransom.overlay file, also the name should be defined in this file with the set of specifications ">put_overlay</a> ( m_pOverlayMgr, <span class="stringliteral">&quot;GUI_Finish&quot;</span>, <span class="keyword">false</span> );</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; _vFader.size(); i++ )</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;      <span class="keywordflow">if</span> (_vFader[i]) <span class="keyword">delete</span> _vFader[i];</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    _vFader.clear();</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <span class="keywordflow">if</span> ( _faderFinish )</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;      <span class="keyword">delete</span> _faderFinish;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <span class="comment">// Parar del track principal...</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;     _gameTrack-&gt;stop();</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="comment">// Erase the enemies deque</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    std::deque&lt;Enemy *&gt;::iterator itEnemy = m_enemies.begin();</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                <span class="keywordflow">while</span> ( m_enemies.end() != itEnemy )</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                {</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;      <span class="keywordflow">if</span> ( *itEnemy )</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        <span class="keyword">delete</span> *itEnemy;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                        ++itEnemy;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                }</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                m_enemies.clear();</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                <span class="keywordflow">if</span> ( m_hero )</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;                {</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="preprocessor">#ifdef _DEBUG</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="preprocessor"></span>                  cout &lt;&lt; <span class="stringliteral">&quot;delete hero&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="preprocessor"></span>      <span class="keyword">delete</span> m_hero;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;                }</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        std::vector&lt;Hostage *&gt;::iterator itHostage = m_hostages.begin();</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;                <span class="keywordflow">while</span> ( m_hostages.end() != itHostage )</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;                {</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      <span class="keywordflow">if</span> ( *itHostage )</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        <span class="keyword">delete</span> *itHostage;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;                        ++itHostage;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;                }</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;                m_hostages.clear();</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        _vCharacters.clear();</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <span class="keywordflow">if</span> ( m_pCamera )</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    {</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="preprocessor">#ifdef _DEBUG</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="preprocessor"></span>      cout &lt;&lt; <span class="stringliteral">&quot;delete camera&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="preprocessor"></span>      m_pSceneMgr-&gt;destroyCamera ( m_pCamera );</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    }</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="keywordflow">if</span> ( _textureListener )</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;      {</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        _rtex-&gt;removeListener ( _textureListener );</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        <span class="keyword">delete</span> _textureListener;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;      }</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;          <span class="keywordflow">if</span> ( _cameraMiniMap )</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    {</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="preprocessor">#ifdef _DEBUG</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="preprocessor"></span>      cout &lt;&lt; <span class="stringliteral">&quot;delete camera&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="preprocessor"></span>      m_pSceneMgr-&gt;destroyCamera ( _cameraMiniMap );</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    }</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        Ogre::TextureManager::getSingleton().remove(<a class="code" href="GameState_8hpp.html#a523b7471b1f9793c3208141cefa02c78">NAME_TEXTUTE_MINIMAP</a>);</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        Ogre::MaterialManager::getSingleton().remove(<a class="code" href="GameState_8hpp.html#ae57cebd1bd814ed81094366fa5fd702b">NAME_MATERIAL_MINIMAP</a>);</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <span class="keywordflow">if</span> ( _world )</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    {</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="preprocessor">#ifdef _DEBUG</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="preprocessor"></span>      cout &lt;&lt; <span class="stringliteral">&quot;delete world&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="preprocessor"></span>      <span class="keyword">delete</span> _world;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    }</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        <span class="keywordflow">if</span> (_staticGeometry) {</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;                m_pSceneMgr-&gt;destroyStaticGeometry(_staticGeometry);</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        }</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <span class="keywordflow">if</span> ( m_pSceneMgr )</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    {</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="preprocessor">#ifdef _DEBUG</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="preprocessor"></span>      cout &lt;&lt; <span class="stringliteral">&quot;delete scene manager&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="preprocessor"></span>      OgreFramework::getSingletonPtr()-&gt;getRootPtr()-&gt;destroySceneManager ( m_pSceneMgr );</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    }</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    _gc.clear();</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  }</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;</div>
<div class="line"><a name="l00368"></a><span class="lineno"><a class="code" href="classGameState.html#aed1e21b59bdd1c2e5536e3668ed55cf5">  368</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classGameState.html#aed1e21b59bdd1c2e5536e3668ed55cf5" title="this method was performed when the key was pressed ">GameState::keyPressed</a>(<span class="keyword">const</span> OIS::KeyEvent &amp;keyEventRef)</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;  {</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        <span class="keywordflow">if</span> (m_bQuit) {</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                <span class="comment">// Mostramos la pantalla final un tiempo determinado</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                <span class="keywordflow">if</span> (_tiempoMostrarFinal &gt;= <a class="code" href="GameState_8hpp.html#a4f3024fdf66e346538e7c878b0bde124">TIMER_END_SHOW</a>) {</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                        popAllAndPushAppState(findByName(<span class="stringliteral">&quot;MenuState&quot;</span>));</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                }</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;                <span class="keywordflow">if</span> ( OgreFramework::getSingletonPtr()-&gt;getKeyboardPtr()-&gt;isKeyDown ( OIS::KC_ESCAPE ) )</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                {</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                        pushAppState(findByName(<span class="stringliteral">&quot;PauseState&quot;</span>));</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;                }</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( OgreFramework::getSingletonPtr()-&gt;getKeyboardPtr()-&gt;isKeyDown ( OIS::KC_SPACE ) )</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                {</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                        m_hero-&gt;shoot();</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;                }</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;        }</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        OgreFramework::getSingletonPtr()-&gt;keyPressed(keyEventRef);</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  }</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;</div>
<div class="line"><a name="l00393"></a><span class="lineno"><a class="code" href="classGameState.html#aa2f87ff327b755de677c3c5af5e303a3">  393</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classGameState.html#aa2f87ff327b755de677c3c5af5e303a3" title="this method was performed when the key was released ">GameState::keyReleased</a>(<span class="keyword">const</span> OIS::KeyEvent &amp;keyEventRef)</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;  {</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    OgreFramework::getSingletonPtr()-&gt;keyPressed ( keyEventRef );</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <span class="keywordflow">if</span> (keyEventRef.key == OIS::KC_UP || keyEventRef.key == OIS::KC_DOWN || keyEventRef.key == OIS::KC_X ) {</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;        m_hero-&gt;stop_move();</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    }</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;  }</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;</div>
<div class="line"><a name="l00404"></a><span class="lineno"><a class="code" href="classGameState.html#ab6860a7205c3469a097b5e5e64189dc7">  404</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classGameState.html#ab6860a7205c3469a097b5e5e64189dc7" title="this method was performed when the mouse was moved ">GameState::mouseMoved</a>(<span class="keyword">const</span> OIS::MouseEvent &amp;evt)</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;  {</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    <span class="keywordflow">if</span> ( OgreFramework::getSingletonPtr()-&gt;getSDKTrayMgrPtr()-&gt;injectMouseMove ( evt ) ) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  }</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;</div>
<div class="line"><a name="l00411"></a><span class="lineno"><a class="code" href="classGameState.html#a4008646c7a47a2df9ac13bdbeec6cb45">  411</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classGameState.html#a4008646c7a47a2df9ac13bdbeec6cb45" title="this method was performed when the mouse button was pressed ">GameState::mousePressed</a>(<span class="keyword">const</span> OIS::MouseEvent &amp;evt, OIS::MouseButtonID <span class="keywordtype">id</span>)</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  {</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <span class="keywordflow">if</span> ( OgreFramework::getSingletonPtr()-&gt;getSDKTrayMgrPtr()-&gt;injectMouseDown ( evt, <span class="keywordtype">id</span> ) )</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <span class="keywordflow">if</span>(<span class="keywordtype">id</span> == OIS::MB_Left)</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;      {</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        onLeftPressed(evt);</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        m_bLMouseDown = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;      }</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<span class="keywordtype">id</span> == OIS::MB_Right)</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;      {</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        m_bRMouseDown = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;      }</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  }</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;</div>
<div class="line"><a name="l00429"></a><span class="lineno"><a class="code" href="classGameState.html#a6268c94f13e2621c5c07223a7af2d4d6">  429</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classGameState.html#a6268c94f13e2621c5c07223a7af2d4d6" title="this method was performed when the mouse button was released ">GameState::mouseReleased</a>(<span class="keyword">const</span> OIS::MouseEvent &amp;evt, OIS::MouseButtonID <span class="keywordtype">id</span>)</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  {</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <span class="keywordflow">if</span> ( OgreFramework::getSingletonPtr()-&gt;getSDKTrayMgrPtr()-&gt;injectMouseUp ( evt, <span class="keywordtype">id</span> ) ) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <span class="keywordflow">if</span>(<span class="keywordtype">id</span> == OIS::MB_Left)</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;      {</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        m_bLMouseDown = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;      }</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<span class="keywordtype">id</span> == OIS::MB_Right)</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;      {</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;        m_bRMouseDown = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;      }</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;  }</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;</div>
<div class="line"><a name="l00445"></a><span class="lineno"><a class="code" href="classGameState.html#a462a6037359db0e198712e34669a076c">  445</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classGameState.html#a462a6037359db0e198712e34669a076c" title="this method was performed when the left mouse button was pressed ">GameState::onLeftPressed</a>(<span class="keyword">const</span> OIS::MouseEvent &amp;evt)</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  {</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;  }</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;</div>
<div class="line"><a name="l00449"></a><span class="lineno"><a class="code" href="classGameState.html#a2db0f70f1eed6ee0fc9669b1f67bb47a">  449</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classGameState.html#a2db0f70f1eed6ee0fc9669b1f67bb47a" title="this method will be run every frame ">GameState::update</a>(<span class="keywordtype">double</span> timeSinceLastFrame)</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;  {</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    _tiempo += timeSinceLastFrame;</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    m_pCamera-&gt;setAspectRatio(Ogre::Real(OgreFramework::getSingletonPtr()-&gt;getViewportPtr()-&gt;getActualWidth()) /</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;                            Ogre::Real(OgreFramework::getSingletonPtr()-&gt;getViewportPtr()-&gt;getActualHeight()));</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    m_FrameEvent.timeSinceLastFrame = timeSinceLastFrame;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    OgreFramework::getSingletonPtr()-&gt;getSDKTrayMgrPtr()-&gt;frameRenderingQueued ( m_FrameEvent );</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <span class="comment">// Fade in/out de los everlays</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; _vFader.size(); i++ )</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;      <span class="keywordflow">if</span> (_vFader[i]) _vFader[i]-&gt;fade ( timeSinceLastFrame );</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;        <span class="comment">// Finalizamos el juego en los casos:</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;        <span class="comment">// - En el caso de que se hayan rescatado todos los rehenes</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        <span class="comment">// - En el caso de que el heroe haya muerto</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    <span class="keywordflow">if</span> ( _hostages == 0 || m_hero-&gt;getHealth() == 0)</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;      {</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                _tiempoMostrarFinal+=timeSinceLastFrame;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        _gameTrack-&gt;stop();</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;                m_bQuit = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        <span class="keywordflow">if</span> ( !_faderFinish )</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;          {</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;            <a class="code" href="classRecords.html#a7212cf91df8738dbaf6c44bdb59683aa" title="method to get the Records object ">Records::getSingleton</a>().<a class="code" href="classRecords.html#a5db25a2e2b2bb652abf7b308229524d7" title="method to add an element to the records table ">add</a> ( _gc.getNumHostages(), _tiempo );</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;            <a class="code" href="classRecords.html#a7212cf91df8738dbaf6c44bdb59683aa" title="method to get the Records object ">Records::getSingleton</a>().<a class="code" href="classRecords.html#a02e25ba5da9e4c21f2ee45e4f9a96833" title="method to fix records number in the file, namely, it set elements number in the records table obviati...">compacta</a> ( 10 );</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;            <a class="code" href="classRecords.html#a7212cf91df8738dbaf6c44bdb59683aa" title="method to get the Records object ">Records::getSingleton</a>().<a class="code" href="classRecords.html#af5cf287ff402973d378e224ffb4c11ef" title="method to write the records table to file The file was named highscores.dat ">write</a>();</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;            <a class="code" href="classUtilities.html#aac351cff9a13eb2d6bd02f38c5b062c0" title="method to get the Utilities object ">Utilities::getSingleton</a>().<a class="code" href="classUtilities.html#a153165e07ae59015a8abdecb84b8d521" title="method to put an overlay in the scene This method put an overlay created in ransom.overlay file, also the name should be defined in this file with the set of specifications ">put_overlay</a> ( m_pOverlayMgr, <span class="stringliteral">&quot;GUI_Game&quot;</span>, <span class="keyword">false</span> );</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;                        <span class="comment">// Segun el caso por el que hayamos finalizado mostramos uno u otro</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;                        <span class="keywordflow">if</span> ( m_hero-&gt;getHealth() == 0 ) {</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                                _faderFinish = <span class="keyword">new</span> <a class="code" href="classFader.html" title="Class to manage the Fader effect on the overlays. ">Fader</a> ( <span class="stringliteral">&quot;GUI_GameOver&quot;</span>, <span class="stringliteral">&quot;Game/GameOver&quot;</span>, <span class="keyword">this</span> );</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                                _faderFinish = <span class="keyword">new</span> <a class="code" href="classFader.html" title="Class to manage the Fader effect on the overlays. ">Fader</a> ( <span class="stringliteral">&quot;GUI_Finish&quot;</span>, <span class="stringliteral">&quot;Game/Finish&quot;</span>, <span class="keyword">this</span> );</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                        }</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;            _faderFinish-&gt;startFadeOut ( 2.0 );</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;          }</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;        <span class="keywordflow">if</span> ( _faderFinish )</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;          _faderFinish-&gt;fade ( timeSinceLastFrame );</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;      } <span class="keywordflow">else</span> { <span class="comment">// Si no hemos finalizado</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;                    <span class="comment">// Actualizacion del overlay del tiempo</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;                        Ogre::OverlayElement *elem = NULL;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;                        elem = m_pOverlayMgr-&gt;getOverlayElement(<span class="stringliteral">&quot;txtTiempo&quot;</span>);</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                        elem-&gt;setCaption ( getTime(_tiempo) );</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;                        <span class="comment">// Actualizacion del overlay de la vida</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;                        elem = m_pOverlayMgr-&gt;getOverlayElement(<span class="stringliteral">&quot;txtHostages&quot;</span>);</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;                        elem-&gt;setCaption ( Ogre::StringConverter::toString(_hostages) );</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;                        <span class="comment">// Actualizamos la barra de vida</span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;                        updatePanelLife();</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;                        <span class="comment">// Actualizar simulacion Bullet</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;                    _world-&gt;stepSimulation(timeSinceLastFrame);</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;                        <span class="comment">// Movemos al heroe</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;                        <span class="keywordflow">if</span> ( OgreFramework::getSingletonPtr()-&gt;getKeyboardPtr()-&gt;isKeyDown ( OIS::KC_RIGHT ) )</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;                          {</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;                                m_hero-&gt;turn_right();</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;                          }</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;                        <span class="keywordflow">if</span> ( OgreFramework::getSingletonPtr()-&gt;getKeyboardPtr()-&gt;isKeyDown ( OIS::KC_LEFT ) )</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;                          {</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;                                m_hero-&gt;turn_left();</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;                          }</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;                        <span class="keywordflow">if</span> ( OgreFramework::getSingletonPtr()-&gt;getKeyboardPtr()-&gt;isKeyDown ( OIS::KC_DOWN ) )</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;                          {</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;                                m_hero-&gt;walk ( <span class="keyword">true</span>, 4.0 );</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;                          }</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;                        <span class="keywordflow">if</span> ( OgreFramework::getSingletonPtr()-&gt;getKeyboardPtr()-&gt;isKeyDown ( OIS::KC_UP ) )</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;                          {</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;                                m_hero-&gt;walk ( <span class="keyword">false</span>, 4.0 );</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;                          }</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;                        <span class="comment">// Actalizamos los enemigos</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;                        m_hero-&gt;update(timeSinceLastFrame, _vCharacters);</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;                        <span class="keywordflow">if</span> ( m_enemies.size() &gt; 0 )</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;                        {</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;                                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 1;</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;                                <span class="keywordflow">for</span> ( std::deque&lt;Enemy *&gt;::iterator itEnemy = m_enemies.begin(); m_enemies.end() != itEnemy; itEnemy++, i++ )</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;                                {</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;                                        (*itEnemy)-&gt;update(timeSinceLastFrame, _vCharacters);</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;                                }</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                        }</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;                        <span class="comment">// Actalizamos los rehenes</span></div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;                        <span class="keywordflow">if</span> ( m_hostages.size() &gt; 0 )</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;                        {</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;                                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 1;</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;                                <span class="keywordflow">for</span> ( std::vector&lt;Hostage *&gt;::iterator itHostage = m_hostages.begin(); m_hostages.end() != itHostage; itHostage++, i++ )</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;                                {</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;                                        (*itHostage)-&gt;update(timeSinceLastFrame, _vCharacters);</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                                }</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;                        }</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;                        <span class="comment">// Miramos si el heroe a encontrado a algun rehen</span></div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;                        <a class="code" href="classHostage.html">Hostage</a>* hostageRescue = detectCollisionHeroWithHostages(_world, m_hero, m_hostages);</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;                        <span class="keywordflow">if</span> (hostageRescue != NULL) {</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;                                hostageRescue-&gt;<a class="code" href="classHostage.html#abfdf103d8c11e23ef456aa6be1062a02" title="method to change state to liberate ">liberate</a>();</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;                                _hostages--;</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;                        }</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;                        <span class="comment">// Actualizamos la camara</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;                        <span class="keywordflow">if</span> (_camerasController != NULL)</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;                                _camerasController-&gt;update(timeSinceLastFrame);</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        } <span class="comment">// End Else de si no hemos finalizado</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;}</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;</div>
<div class="line"><a name="l00557"></a><span class="lineno"><a class="code" href="classGameState.html#ae500bf944bd74cac5c5615ecff359d61">  557</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classGameState.html#ae500bf944bd74cac5c5615ecff359d61" title="method to create map ">GameState::CreateMap</a>()</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;{</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;        <span class="keywordtype">float</span> widthScene = <a class="code" href="GameConfig_8h.html#a95c2c18c2a5f56f4e02efc3198907351">SIZE_PART</a> * _gc.getColsMap();</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        <span class="keywordtype">float</span> heightScene = <a class="code" href="GameConfig_8h.html#a95c2c18c2a5f56f4e02efc3198907351">SIZE_PART</a> * _gc.getRowsMap();</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;        <span class="keywordtype">float</span> heightWall = 10.0f;</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;        _staticGeometry = m_pSceneMgr-&gt;createStaticGeometry(<span class="stringliteral">&quot;StaticMap&quot;</span>);</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;        <span class="comment">// Creamos las paredes (Ponemos el material Menu/Vacio porque es el que tiene asignado el PNG de total transparencia)</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;        <a class="code" href="classUtilities.html#aac351cff9a13eb2d6bd02f38c5b062c0" title="method to get the Utilities object ">Utilities::getSingleton</a>().<a class="code" href="classUtilities.html#ad9d9b0c6e6793366ea65ad5082b66521" title="this method add an plane in the scene ">put_plane_in_scene</a>(m_pSceneMgr, _world, _staticGeometry, <span class="stringliteral">&quot;leftWall&quot;</span>, <span class="stringliteral">&quot;Menu/Vacio&quot;</span>, heightScene, heightWall,</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;                                                                                                        Vector3::UNIT_Y, Vector3(1,0,0), Vector3(widthScene / -2.0f,0,0));</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;        <a class="code" href="classUtilities.html#aac351cff9a13eb2d6bd02f38c5b062c0" title="method to get the Utilities object ">Utilities::getSingleton</a>().<a class="code" href="classUtilities.html#ad9d9b0c6e6793366ea65ad5082b66521" title="this method add an plane in the scene ">put_plane_in_scene</a>(m_pSceneMgr, _world, _staticGeometry, <span class="stringliteral">&quot;rightWall&quot;</span>, <span class="stringliteral">&quot;Menu/Vacio&quot;</span>, heightScene, heightWall,</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;                                                                                                        Vector3::UNIT_Y, Vector3(-1,0,0), Vector3(widthScene / 2.0f,0,0));</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;        <a class="code" href="classUtilities.html#aac351cff9a13eb2d6bd02f38c5b062c0" title="method to get the Utilities object ">Utilities::getSingleton</a>().<a class="code" href="classUtilities.html#ad9d9b0c6e6793366ea65ad5082b66521" title="this method add an plane in the scene ">put_plane_in_scene</a>(m_pSceneMgr, _world, _staticGeometry, <span class="stringliteral">&quot;upWall&quot;</span>, <span class="stringliteral">&quot;Menu/Vacio&quot;</span>, widthScene, heightWall,</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;                                                                                                        Vector3::UNIT_Y, Vector3(0,0,1), Vector3(0,0,heightScene / -2.0f));</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        <a class="code" href="classUtilities.html#aac351cff9a13eb2d6bd02f38c5b062c0" title="method to get the Utilities object ">Utilities::getSingleton</a>().<a class="code" href="classUtilities.html#ad9d9b0c6e6793366ea65ad5082b66521" title="this method add an plane in the scene ">put_plane_in_scene</a>(m_pSceneMgr, _world, _staticGeometry, <span class="stringliteral">&quot;downWall&quot;</span>, <span class="stringliteral">&quot;Menu/Vacio&quot;</span>, widthScene, heightWall,</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;                                                                                                        Vector3::UNIT_Y, Vector3(0,0,-1), Vector3(0,0,heightScene / 2.0f));</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;        <a class="code" href="classPiece.html" title="Class to manage the map pieces. ">Piece</a>* pieza = NULL;</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;        <span class="keywordtype">string</span> nomPieza = <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        <span class="comment">// Creamos el mapa que habia en la cofig y que hemos generado</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;        <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; _gc.getNumPiecesMap(); i++ )</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;        {</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;                nomPieza = <span class="stringliteral">&quot;Pieza&quot;</span> + StringConverter::toString ( i+1 );</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;                pieza = _gc.getPieceMap(i).pPiece;</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;                <a class="code" href="classUtilities.html#aac351cff9a13eb2d6bd02f38c5b062c0" title="method to get the Utilities object ">Utilities::getSingleton</a>().<a class="code" href="classUtilities.html#aa07a055a9ad92d6d160b70db8051b418" title="this method add an part map in the scene ">put_part_map_in_scene</a></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;                                        ( m_pSceneMgr,</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;                                                _world,</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;                                                _staticGeometry,</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;                                                nomPieza,</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;                                                pieza-&gt;<a class="code" href="classPiece.html#a031ec9f1b92671ccd516607a9387b42a" title="method to get the mesh file name ">getNameMeshFile</a>(),</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;                                                _gc.getPieceMap(i).pos );</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;        }</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;        _staticGeometry-&gt;build();</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;}</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;</div>
<div class="line"><a name="l00597"></a><span class="lineno"><a class="code" href="classGameState.html#ab6922d2e68a06f827b61dd098b02f400">  597</a></span>&#160;<a class="code" href="classHostage.html">Hostage</a>* <a class="code" href="classGameState.html#ab6922d2e68a06f827b61dd098b02f400" title="method to detecting collisions between Hero with Hostages ">GameState::detectCollisionHeroWithHostages</a>(OgreBulletDynamics::DynamicsWorld* world,</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;                                                                                                <a class="code" href="classHero.html">Hero</a>* hero,</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;                                                                                                std::vector&lt;Hostage*&gt; hostages) {</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;        <span class="keywordtype">bool</span> isCollition = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;        <a class="code" href="classHostage.html">Hostage</a>* hostageCollisition = NULL;</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;        <a class="code" href="classHostage.html">Hostage</a>* hostage = NULL;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        btCollisionWorld *bulletWorld = world-&gt;getBulletCollisionWorld();</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        <span class="keywordtype">int</span> numManifolds = bulletWorld-&gt;getDispatcher()-&gt;getNumManifolds();</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;        <span class="keywordtype">int</span> numHostages = hostages.size();</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        btPersistentManifold* contactManifold = NULL;</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        btCollisionObject* obA;</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        btCollisionObject* obB;</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        <span class="comment">// Recorremos las colisiones que se esten produciendo</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;numManifolds &amp;&amp; !isCollition;i++) {</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;                contactManifold = bulletWorld-&gt;getDispatcher()-&gt;getManifoldByIndexInternal(i);</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;                obA = (btCollisionObject*)(contactManifold-&gt;getBody0());</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;                obB = (btCollisionObject*)(contactManifold-&gt;getBody1());</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;                OgreBulletCollisions::Object* obOB_A = world-&gt;findObject(obA);</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;                OgreBulletCollisions::Object* obOB_B = world-&gt;findObject(obB);</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;                <span class="keywordflow">if</span> (obOB_A == hero-&gt;<a class="code" href="classCharacter.html#aecd625855f699e4557f90aaf69aabb35" title="method to get rigid body reference ">getRigidBody</a>() || obOB_B == hero-&gt;<a class="code" href="classCharacter.html#aecd625855f699e4557f90aaf69aabb35" title="method to get rigid body reference ">getRigidBody</a>()) {</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;                        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;numHostages &amp;&amp; !isCollition;j++) {</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;                                hostage = hostages[j];</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;                                <span class="keywordflow">if</span> (hostage-&gt;<a class="code" href="classHostage.html#a7624d3cacc5c1a80c6847a77339901bf" title="method to get state of hostage ">getState</a>() == <a class="code" href="Hostage_8h.html#a866a7052a04fd84e6b7067b2cf174d70a2a90047fe45c6934034c89fd9fb5dbbb">CAPTURE</a>) {</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;                                        isCollition = (obOB_A == hostage-&gt;<a class="code" href="classCharacter.html#aecd625855f699e4557f90aaf69aabb35" title="method to get rigid body reference ">getRigidBody</a>() || obOB_B == hostage-&gt;<a class="code" href="classCharacter.html#aecd625855f699e4557f90aaf69aabb35" title="method to get rigid body reference ">getRigidBody</a>());</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;                                        <span class="keywordflow">if</span> (isCollition) hostageCollisition = hostage;</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;                                }</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;                        }</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;                }</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;        }</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;        <span class="keywordflow">return</span> hostageCollisition;</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;}</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;</div>
<div class="line"><a name="l00632"></a><span class="lineno"><a class="code" href="classGameState.html#a62979e2ba17d0145c3e60b4604d44a44">  632</a></span>&#160;<span class="keywordtype">string</span> <a class="code" href="classGameState.html#a62979e2ba17d0145c3e60b4604d44a44" title="this method translate the time from seconds to hh:mm:ss ">GameState::getTime</a> ( <span class="keywordtype">double</span> time )</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;  {</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> minutos = 0, segundos = 0;</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    <span class="keywordtype">char</span> cad[6];</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    <span class="keywordtype">string</span> ret = <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    minutos = (int)time / 60;</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    segundos = (int)time % 60;</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    sprintf ( cad, <span class="stringliteral">&quot;%02d:%02d&quot;</span>, minutos, segundos );</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    ret = cad;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;  }</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;</div>
<div class="line"><a name="l00648"></a><span class="lineno"><a class="code" href="classGameState.html#a8d2021a891710420d0dcf9d8df6172fb">  648</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classGameState.html#a8d2021a891710420d0dcf9d8df6172fb" title="this method update hero panel life ">GameState::updatePanelLife</a>()</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;  {</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> currentPanelLife = 0;</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    <span class="comment">// Esto es una √±apa, para que la cara del prota en rojo aparezca durante unos minimos instantes</span></div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    <span class="comment">// y no sea un visto y no visto</span></div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> contREDFace = 0;</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    <span class="keywordflow">if</span> ( m_hero-&gt;getHealth() &gt; 75 )</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;      currentPanelLife = 4;</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( m_hero-&gt;getHealth() &gt; 50 &amp;&amp; m_hero-&gt;getHealth() &lt;= 75 )</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;      currentPanelLife = 3;</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( m_hero-&gt;getHealth() &gt; 25 &amp;&amp; m_hero-&gt;getHealth() &lt;= 50 )</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;      currentPanelLife = 2;</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;      currentPanelLife = 1;</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    Ogre::OverlayElement *elem = NULL;</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    <span class="keywordflow">if</span> ( currentPanelLife != _lastPanelLife )</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;      {</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;        elem = m_pOverlayMgr-&gt;getOverlayElement(<span class="stringliteral">&quot;Panel_Life_Hero_Game&quot;</span>);</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;        <span class="keywordflow">if</span> ( m_hero-&gt;getHealth() &gt; 75 ) {</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;         elem-&gt;setMaterialName ( <span class="stringliteral">&quot;Game/Life4&quot;</span> );</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;         _lastPanelLife = 4;</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( m_hero-&gt;getHealth() &gt; 50 &amp;&amp; m_hero-&gt;getHealth() &lt;= 75 ) {</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;         elem-&gt;setMaterialName ( <span class="stringliteral">&quot;Game/Life3&quot;</span> );</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;         _lastPanelLife = 3;</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;        }</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( m_hero-&gt;getHealth() &gt; 25 &amp;&amp; m_hero-&gt;getHealth() &lt;= 50 ) {</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;         elem-&gt;setMaterialName ( <span class="stringliteral">&quot;Game/Life2&quot;</span> );</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;         _lastPanelLife = 2;</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;        }</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;         elem-&gt;setMaterialName ( <span class="stringliteral">&quot;Game/Life1&quot;</span> );</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;         _lastPanelLife = 1;</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;        }</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;        <span class="keywordflow">if</span> ( _lastPanelLife != 0 &amp;&amp; currentPanelLife != 4 )</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;        {</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;          elem = m_pOverlayMgr-&gt;getOverlayElement(<span class="stringliteral">&quot;Panel_Face_Hero_Game&quot;</span>);</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;          elem-&gt;setMaterialName ( <span class="stringliteral">&quot;Game/Face_RED&quot;</span> );</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;          <span class="comment">// Pasar√° 100 veces por √©ste m√©todo antes de quitar la cara roja</span></div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;          contREDFace = 100;</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;        }</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;      }</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;      {</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;        <span class="comment">// Si estamos a 0 es que hemos pasado ya todas las veces necesarias</span></div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;        <span class="comment">// por este metodo y volvemos a restablecer la cara azul normal del prota</span></div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;        <span class="keywordflow">if</span> ( contREDFace == 0 )</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;          {</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;            elem = m_pOverlayMgr-&gt;getOverlayElement(<span class="stringliteral">&quot;Panel_Face_Hero_Game&quot;</span>);</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;            elem-&gt;setMaterialName ( <span class="stringliteral">&quot;Game/Face&quot;</span> );</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;          }</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;        <span class="comment">// Si el valor es positivo, quiere decir que nos quedan mas veces que</span></div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;        <span class="comment">// pasar por este metodo antes de quitar la cara roja</span></div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( contREDFace &gt; 0 )</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;          {</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;            contREDFace--;</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;          }</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;      }</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;  }</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;</div>
<div class="line"><a name="l00718"></a><span class="lineno"><a class="code" href="classGameState.html#a4ffbe3bd7b0108f21421902c3c699dbf">  718</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classGameState.html#a4ffbe3bd7b0108f21421902c3c699dbf" title="this method was executed when the Fader effect was over ">GameState::fadeOutCallback</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;  {</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    <span class="keywordflow">if</span> ( _hostages == 0 )</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;      _soundFinish-&gt;play();</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;      _soundGameOver-&gt;play();</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;  }</div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="GameState_8cpp.html">GameState.cpp</a></li>
    <li class="footer">Generated on Sat Jul 20 2013 19:50:26 for RANSOM by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.4 </li>
  </ul>
</div>
</body>
</html>
